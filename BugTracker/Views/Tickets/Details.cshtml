@model BugTracker.Models.Ticket
@using Microsoft.AspNet.Identity
@using BugTracker.Helpers

@{
    ViewBag.Title = "Details";
}

<div class="row">
    <div class="col-md-8">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="card title">Ticket Info</h2>

                <div class="ticket-details">

                    <div class="text-left">
                        <hr />
                        <div class="post=header">
                            <h4><b>Ticket Title:</b></h4> @Model.Title
                        </div>

                        <div class="post-body">
                            <h4><b>Description:</b></h4> @Html.Raw(Model.Description)

                        </div>

                        <br />

                        <h4><b>Progress:</b></h4>
                        <div class="progress">
                            <div class="progress-bar bg-warning progress-bar-striped" role="progressbar" style="width: 90%" aria-valuenow="90" aria-valuemin="0"
                                 aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <br />

    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h2>Attachments</h2>
                @using (Html.BeginForm("Create", "TicketAttachments", FormMethod.Post, new { enctype = "Multipart/Form-Data", @class = "form-control" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("TicketId", Model.Id)

                    <form>
                        <div class="input-group">
                            <input name="filePath" type="file" class="form-control" id="fileUpload" />
                            <span class="input-group-append">
                                <button class="file-upload-browse btn btn-primary" type="submit">Upload</button>
                            </span>
                        </div>

                        <br />

                        @{ 
                            var iHelper = new iconHelper();
                            var icon = iconHelper.GetAssociatedIcon("");

                        }

                        @foreach (var attach in Model.TicketAttachments)
                        {

                            

                                <div class="text-left">
                                     <a href=@Url.Content(attach.FilePath) target="_blank">@attach.FilePath.Split('/')[2]</a> <br />
                                </div>
                        
                        
                            <br />

                        }

                        <br />
                        <br />
                        <br />
                        <div class="form-group"> 
                            <div class="col-md-offset-1 col-md-11">

                            </div>
                        </div>
                    </form>
                }


            </div>
        </div>
    </div>

    <br />

</div>

<br />

<div class="row">
    <div class="col-md-8">
        <div class="card text-center">
            <div class="card-body">
                <h2>Comments</h2>

                <hr />

                @foreach (var Comment in Model.TicketComments.OrderByDescending(c => c.Created))
                {
                    <p>@Html.Raw(Comment.CommentBody)</p>
                    <p><b>Comment by @Comment.User.FirstName on @Comment.Created.ToString("MM/dd/yy") </b></p>

       
                    <hr />
                }
              
                    @using (Html.BeginForm("Create", "TicketComments", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                    {
                        @Html.AntiForgeryToken();
                        @Html.Hidden("TicketId", Model.Id);
                      

                        <div class="add-comment">
                            <header>
                                <h3 class="h6">Any comments?</h3>
                            </header>
                            <form action="#" class="commenting-form">
                                <div class="row">

                                    <div class="form-group col-md-12">
                                        @Html.Editor("CommentBody")
                                    </div>
                                    <div class="form-group col-md-12">
                                        <button type="submit" class="btn btn-rounded btn-primary">Submit Comment</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    }
                
            </div>
        </div>
    </div>
</div>
@section Scripts{

    <script src="~/Scripts/tinymce/jquery.tinymce.min.js"></script>
    <script src="~/Scripts/tinymce/tinymce.min.js"></script>
    <script type="text/javascript">
        $(function () {
            tinymce.init({
                selector: '#CommentBody'
            });
        });
    </script>

   
     @Scripts.Render("~/bundles/jqueryval")

}